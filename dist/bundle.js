!function(e){var t={};function r(n){if(t[n])return t[n].exports;var s=t[n]={i:n,l:!1,exports:{}};return e[n].call(s.exports,s,s.exports,r),s.l=!0,s.exports}r.m=e,r.c=t,r.d=function(e,t,n){r.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:n})},r.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},r.t=function(e,t){if(1&t&&(e=r(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var n=Object.create(null);if(r.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var s in e)r.d(n,s,function(t){return e[t]}.bind(null,s));return n},r.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return r.d(t,"a",t),t},r.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},r.p="",r(r.s=0)}([function(e,t,r){"use strict";r.r(t);class n{constructor(e){this._self=document.querySelector("#text-block"),this._text=e.text,this._charIndex=0,this._init()}_init(){this._self.focus(),this._populateContent(this._text),this._underlineCurrentChar()}_populateContent(e){let t=e.quote,r="";for(let e in t)r+='<span id="char-'+e+'">'+t[e]+"</span>";document.querySelector("#quote").innerHTML=r;let n=e.source;n&&n.length>0&&(document.querySelector("#source").innerHTML=e.source)}_underlineCurrentChar(){let e=document.querySelector(`#char-${this._charIndex}`);e&&(e.style.textDecoration="underline")}_getCurrentCharSpan(){return document.querySelector(`#char-${this._charIndex}`)}_colorCurrentChar(e){let t=this._getCurrentCharSpan();t.classList.add(e?"success":"failure"),t.style.textDecoration="none"}addKeyPressListener(e=(()=>{})){this._self.addEventListener("keypress",e)}nextChar(e){this._colorCurrentChar(e),this._charIndex++,this._underlineCurrentChar()}isTextEndReached(){return this._charIndex>=this._text.quote.length}isWordEndReached(){return" "===this._text.quote[this._charIndex]||this.isTextEndReached()}getCurrentChar(){return this._text.quote[this._charIndex]}focus(){this._self.focus()}disable(){this._self.removeAttribute("tabindex")}}const s={en:{errors:"Errors",accuracy:"Accuracy",speed:"Speed",reset:"Reset"},fr:{errors:"Erreurs",accuracy:"Précision",speed:"Vitesse",reset:"Réinitialiser"}},a={en:["Short text.","Here is another text in english.","Hello, world!"],fr:["Un texte francais.","C'est un autre texte."]};class o{constructor(){this.languageCode="en";let e=new URLSearchParams(window.location.search).get("lang");e&&(this.languageCode=e)}static getInstance(){return this.i18n||(this.i18n=new o),this.i18n}translate(e){return s[this.languageCode][e]}setLanguageCode(e){this.languageCode=e}getLanguageCode(){return this.languageCode}generateText(){let e=Math.floor(Math.random()*a[this.languageCode].length);return a[this.languageCode][e]}}class i{constructor(e){this._presenter=e,document.querySelector("#errors-label").innerHTML=o.getInstance().translate("errors"),this._errorSpan=document.querySelector("#error-count"),this._errorSpan.innerHTML=0,document.querySelector("#accuracy-label").innerHTML=o.getInstance().translate("accuracy"),this._accuracySpan=document.querySelector("#accuracy-value"),this._accuracySpan.innerHTML=100,document.querySelector("#speed-label").innerHTML=o.getInstance().translate("speed"),this._speedSpan=document.querySelector("#speed"),this._speedSpan.innerHTML=0}updateErrorSpan(e){this._errorSpan.innerHTML=e}updateAccuracySpan(e){this._accuracySpan.innerHTML=e}updateSpeedSpan(e){this._speedSpan.innerHTML=e}}class c{constructor(e,t){this._typer=e,this._text=t,this._errorCount=0,this._charSuccessCount=0,this._charTypedCount=0,this._initTime=this._timeNow()}get text(){return this._text}_timeNow(){return Date.now()}_nextChar(e){this._typer.nextChar(e)}_increaseErrorCount(){this._typer.updateErrorSpan(++this._errorCount)}charPressSuccess(){this._charSuccessCount++,this._charTypedCount++,this._nextChar(!0)}charPressFailure(){this._charTypedCount++,this._increaseErrorCount(),this._nextChar(!1)}updateSpeed(){let e=(this._timeNow()-this._initTime)/1e3,t=Math.ceil(60*this._charSuccessCount/e);this._typer.updateSpeedSpan(t)}updateAccuracyPercentage(){let e=Math.round(this._charSuccessCount/this._charTypedCount*100);this._typer.updateAccuracySpan(e)}}var u=r.p+"a069a29cfd9d21e11be1bd235e569c69.png";class h{constructor(e){this._self=document.querySelector("#typer"),this._presenter=new c(this,e),this._textBlock=new n(this._presenter),this._summary=new i(this._presenter),document.querySelector("#image").src=u,document.querySelector("#reset-label").innerHTML=o.getInstance().translate("reset"),this._resetButton=document.querySelector("#btn-reset"),this._init()}_init(){this._self.addEventListener("click",()=>{this._textBlock.focus()}),this._resetButton.addEventListener("click",()=>{location.reload()}),this._textBlock.addKeyPressListener(()=>{event.key===this._textBlock.getCurrentChar()?this._presenter.charPressSuccess():this._presenter.charPressFailure()})}nextChar(e){this._textBlock.nextChar(e),this._presenter.updateAccuracyPercentage(),this._textBlock.isWordEndReached()&&this._presenter.updateSpeed(),this._textBlock.isTextEndReached()&&(this._textBlock.disable(),this._resetButton.removeAttribute("hidden"),this._resetButton.focus())}updateErrorSpan(e){this._summary.updateErrorSpan(e)}updateSpeedSpan(e){this._summary.updateSpeedSpan(e)}updateAccuracySpan(e){this._summary.updateAccuracySpan(e)}}class l{constructor(){this.languageChooser=document.querySelector("#language-chooser select"),this.form=document.querySelector("#form-lang"),this._init()}_init(){this._updateComponent(),this.languageChooser.addEventListener("change",()=>{let e=event.target.selectedOptions[0].value;o.getInstance().setLanguageCode(e),this.form.submit()})}_updateComponent(){let e=o.getInstance().getLanguageCode();for(let t of this.languageChooser.options)t.value===e?t.setAttribute("selected",!0):t.removeAttribute("selected");document.querySelector("html").setAttribute("lang",e)}}class d{constructor(){this.baseUrl="http://localhost:5000",this.languageCode="en";let e=new URLSearchParams(window.location.search).get("lang");e&&(this.languageCode=e)}async exec(){const e=`${this.baseUrl}/text/random/${this.languageCode}`;let t=await fetch(e);if(t.ok){return await t.json()}throw`${t.status}: ${t.statusText}`}}class p{constructor(){this.service=new d,this.typer,this._init()}_init(){this.service.exec().then(e=>{this._showContent(),this.typer=new h(e),new l,this._populateFooter()}).catch(e=>{console.error(e)})}_showContent(){this.spinner=document.querySelector("#spinner"),this.content=document.querySelector("#content"),this.spinner.setAttribute("hidden",!0),this.content.removeAttribute("hidden")}_populateFooter(){document.querySelector("footer").querySelector("span").innerHTML=(new Date).getFullYear()}}window.onload=()=>{new p}}]);