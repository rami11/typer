!function(e){var t={};function s(r){if(t[r])return t[r].exports;var n=t[r]={i:r,l:!1,exports:{}};return e[r].call(n.exports,n,n.exports,s),n.l=!0,n.exports}s.m=e,s.c=t,s.d=function(e,t,r){s.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:r})},s.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},s.t=function(e,t){if(1&t&&(e=s(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var r=Object.create(null);if(s.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var n in e)s.d(r,n,function(t){return e[t]}.bind(null,n));return r},s.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return s.d(t,"a",t),t},s.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},s.p="",s(s.s=0)}([function(e,t,s){"use strict";s.r(t);class r{constructor(e="div",t=""){this._self=document.createElement(e),this._self.id=t}setId(e){this._self.id=e}addListener(e,t=(()=>{})){this._self.addEventListener(e,t)}addClassName(e){this._self.classList.add(e)}removeClassName(e){this._self.classList.remove(e)}focus(){this._self.setAttribute("tabindex",0),this._self.focus()}setVisible(e){e?this._self.removeAttribute("hidden"):this._self.setAttribute("hidden",!0)}setVisibleKeepSpace(e){this._self.style.visibility=e?"visible":"hidden"}}class n extends r{constructor(e="div",t){super(e,t),this._components=[]}add(){for(let e in arguments)this._components.push(arguments[e]),this._self.appendChild(arguments[e]._self)}addAt(e,t){this._components[e]=t,this._components.forEach(e=>this._self.appendChild(e._self))}clear(){this._self.innerHTML=""}}class i extends n{constructor(e=""){super("div",e)}}class a extends n{constructor(e="",t=""){super("span",e),this.setText(t)}setText(e){this._self.innerHTML=e}}class o extends i{constructor(e){super("text-block"),this._textSpans=[],this._text=e.text,this._charIndex=0,this._init()}_init(){this._populateContent(this._text),this._underlineCurrentChar(),this.focus()}_populateContent(e){let t=e.quote;this.add(new a("","“"));let s=new a("quote");for(let e in t){let r=new a(`char-${e}`,t[e]);s.add(r),this._textSpans.push(r)}this.add(s),this.add(new a("","” - "));let r=e.source;r&&r.length>0&&this.add(new a("source",r))}_underlineCurrentChar(){let e=this._textSpans[this._charIndex];e&&e.addClassName("underline")}_getCurrentCharSpan(){return this._textSpans[this._charIndex]}_colorCurrentChar(e){let t=this._getCurrentCharSpan();t.addClassName(e?"success":"failure"),t.removeClassName("underline")}addKeyPressListener(e=(()=>{})){this.addListener("keypress",e)}nextChar(e){this._colorCurrentChar(e),this._charIndex++,this._underlineCurrentChar()}isTextEndReached(){return this._charIndex>=this._text.quote.length}isWordEndReached(){return" "===this._text.quote[this._charIndex]||this.isTextEndReached()}getCurrentChar(){return this._text.quote[this._charIndex]}disable(){this._self.removeAttribute("tabindex")}}const c={en:{errors:"Errors",accuracy:"Accuracy",speed:"Speed",reset:"Reset"},fr:{errors:"Erreurs",accuracy:"Précision",speed:"Vitesse",reset:"Réinitialiser"}},h={en:["Short text.","Here is another text in english.","Hello, world!"],fr:["Un texte francais.","C'est un autre texte."]};class d{constructor(){this.languageCode="en";let e=new URLSearchParams(window.location.search).get("lang");e&&(this.languageCode=e)}static getInstance(){return this.i18n||(this.i18n=new d),this.i18n}translate(e){return c[this.languageCode][e]}setLanguageCode(e){this.languageCode=e}getLanguageCode(){return this.languageCode}generateText(){let e=Math.floor(Math.random()*h[this.languageCode].length);return h[this.languageCode][e]}}class l extends i{constructor(e){super("summary-block"),this._presenter=e,this._init()}_init(){let e=this._buildErrorBlock(),t=this._buildAccuracyBlock(),s=this._buildSpeedBlock();this.add(e),this.add(t),this.add(s)}_buildErrorBlock(){let e=new i;e.addClassName("small-block");let t=new a("errors-label");return t.setText(`${d.getInstance().translate("errors")} `),this._errorSpan=new a("error-count"),this._errorSpan.setText(0),e.add(t),e.add(this._errorSpan),e}_buildAccuracyBlock(){let e=new i("accuracy");e.addClassName("small-block");let t=new a("accuracy-label");t.setText(`${d.getInstance().translate("accuracy")} `),this._accuracySpan=new a("accuracy-value"),this._accuracySpan.setText(100);let s=new a("","%");return e.add(t),e.add(this._accuracySpan),e.add(s),e}_buildSpeedBlock(){let e=new i("speed-block");e.addClassName("small-block");let t=new a("speed-label");t.setText(`${d.getInstance().translate("speed")} `),this._speedSpan=new a("speed"),this._speedSpan.setText(0);let s=new a(""," CPM");return e.add(t),e.add(this._speedSpan),e.add(s),e}updateErrorSpan(e){this._errorSpan.setText(e)}updateAccuracySpan(e){this._accuracySpan.setText(e)}updateSpeedSpan(e){this._speedSpan.setText(e)}}class u{constructor(e,t,s){this._socket=e,this._typer=s,this._text=t,this._errorCount=0,this._charSuccessCount=0,this._charTypedCount=0,this._initTime=this._timeNow(),this._completePercent=0}get text(){return this._text}set completePercent(e){this._completePercent=e,this._typer.broadcast(e)}_timeNow(){return Date.now()}_nextChar(e){this._charTypedCount++,this._typer.nextChar(e),this.completePercent=Math.ceil(100*this._charTypedCount/this.text.quote.length)}_increaseErrorCount(){this._typer.updateErrorSpan(++this._errorCount)}charPressSuccess(){this._charSuccessCount++,this._nextChar(!0)}charPressFailure(){this._increaseErrorCount(),this._nextChar(!1)}updateSpeed(){let e=(this._timeNow()-this._initTime)/1e3,t=Math.ceil(60*this._charSuccessCount/e);this._typer.updateSpeedSpan(t)}updateAccuracyPercentage(){let e=Math.round(this._charSuccessCount/this._charTypedCount*100);this._typer.updateAccuracySpan(e)}}var _=s.p+"a069a29cfd9d21e11be1bd235e569c69.png";class p extends n{constructor(e=""){super("button",e)}setText(e){this._self.innerHTML=e}}class g extends r{constructor(e){super("img",e)}setSrc(e){this._self.src=e}}class m extends i{constructor(){super(),this._progress=new i,this._init()}_init(){this.addClassName("progress-bar"),this._progress.addClassName("progress"),this.add(this._progress)}setValue(e){this._progress._self.style.width=`${e}%`}}class x extends i{constructor(e,t){super("typer"),this._presenter=new u(e,t,this),this._socket=e,this._textBlock=new o(this._presenter),this._summary=new l(this._presenter),this._init()}_buildImageSection(){let e=new i("image-section"),t=new g("image");return t.setSrc(_),e.add(t),e}_buildBottomSection(){let e=new i("bottom-section");return this._resetButton=new p("btn-reset"),this._resetButton.setVisibleKeepSpace(!1),this._resetButton.setText(`<i class="fa fa-refresh"></i> ${d.getInstance().translate("reset")}`),e.add(this._resetButton),e}_init(){let e=this._buildImageSection(),t=this._buildBottomSection();this.add(this._summary),this.add(e),this.add(this._textBlock),this.add(t),this.addListener("click",()=>{this._textBlock.focus()}),this._resetButton.addListener("click",()=>{location.reload()}),this._textBlock.addKeyPressListener(()=>{event.key===this._textBlock.getCurrentChar()?this._presenter.charPressSuccess():this._presenter.charPressFailure()})}nextChar(e){this._textBlock.nextChar(e),this._presenter.updateAccuracyPercentage(),this._textBlock.isWordEndReached()&&this._presenter.updateSpeed(),this._textBlock.isTextEndReached()&&(this._textBlock.disable(),this._resetButton.setVisibleKeepSpace(!0),this._resetButton.focus())}updateErrorSpan(e){this._summary.updateErrorSpan(e)}updateSpeedSpan(e){this._summary.updateSpeedSpan(e)}updateAccuracySpan(e){this._summary.updateAccuracySpan(e)}focus(){this._textBlock.focus()}broadcast(e){this._socket.emit("progress",e)}}class f{constructor(){this.languageChooser=document.querySelector("#language-chooser select"),this.form=document.querySelector("#form-lang"),this._init()}_init(){this._updateComponent(),this.languageChooser.addEventListener("change",()=>{let e=event.target.selectedOptions[0].value;d.getInstance().setLanguageCode(e),this.form.submit()})}_updateComponent(){let e=d.getInstance().getLanguageCode();for(let t of this.languageChooser.options)t.value===e?t.setAttribute("selected",!0):t.removeAttribute("selected");document.querySelector("html").setAttribute("lang",e)}}class C{constructor(){this.baseUrl="http://localhost:5000",this.languageCode="en";let e=new URLSearchParams(window.location.search).get("lang");e&&(this.languageCode=e)}async exec(){const e=`${this.baseUrl}/text/random/${this.languageCode}`;let t=await fetch(e);if(t.ok){return await t.json()}throw`${t.status}: ${t.statusText}`}}class S{constructor(e){this._socket=e,this._progressBarDict={},this._init()}_init(){this._socket.on("connect",()=>{console.log("I'm connected",this._socket.id)}),this._socket.on("message",e=>{let t=new i;t.addClassName("block");for(let s in e){let e=new i;e.addClassName("golden-block"),e.add(new a("",s===this._socket.id?"Me":s));let r=new m;this._progressBarDict[s]=r,e.add(r),t.add(e)}let s=document.querySelector("#connected-sockets");s.innerHTML="",s.appendChild(t._self)}),this._socket.on("progress",e=>{this._progressBarDict[e.socketId].setValue(e.completePercent)})}}class y{constructor(e){this.service=new C,this._typer,this._socket=e,this._init()}_init(){this.service.exec().then(e=>{this._showContent(),this._typer=new x(this._socket,e),new f,document.querySelector("main").appendChild(this._typer._self),this._typer.focus(),this._populateFooter()}).catch(e=>{console.error(e)})}_showContent(){this.spinner=document.querySelector("#spinner"),this.content=document.querySelector("#content"),this.spinner.setAttribute("hidden",!0),this.content.removeAttribute("hidden")}_populateFooter(){document.querySelector("footer").querySelector("span").innerHTML=(new Date).getFullYear()}}window.onload=()=>{const e=io("http://localhost:5000");new y(e),new S(e)}}]);