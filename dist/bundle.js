!function(e){var t={};function s(r){if(t[r])return t[r].exports;var n=t[r]={i:r,l:!1,exports:{}};return e[r].call(n.exports,n,n.exports,s),n.l=!0,n.exports}s.m=e,s.c=t,s.d=function(e,t,r){s.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:r})},s.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},s.t=function(e,t){if(1&t&&(e=s(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var r=Object.create(null);if(s.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var n in e)s.d(r,n,function(t){return e[t]}.bind(null,n));return r},s.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return s.d(t,"a",t),t},s.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},s.p="",s(s.s=4)}([function(e,t,s){var r=s(1),n=s(2);"string"==typeof(n=n.__esModule?n.default:n)&&(n=[[e.i,n,""]]);var i={insert:"head",singleton:!1},a=(r(n,i),n.locals?n.locals:{});e.exports=a},function(e,t,s){"use strict";var r,n=function(){return void 0===r&&(r=Boolean(window&&document&&document.all&&!window.atob)),r},i=function(){var e={};return function(t){if(void 0===e[t]){var s=document.querySelector(t);if(window.HTMLIFrameElement&&s instanceof window.HTMLIFrameElement)try{s=s.contentDocument.head}catch(e){s=null}e[t]=s}return e[t]}}(),a=[];function o(e){for(var t=-1,s=0;s<a.length;s++)if(a[s].identifier===e){t=s;break}return t}function c(e,t){for(var s={},r=[],n=0;n<e.length;n++){var i=e[n],c=t.base?i[0]+t.base:i[0],d=s[c]||0,l="".concat(c," ").concat(d);s[c]=d+1;var h=o(l),u={css:i[1],media:i[2],sourceMap:i[3]};-1!==h?(a[h].references++,a[h].updater(u)):a.push({identifier:l,updater:g(u,t),references:1}),r.push(l)}return r}function d(e){var t=document.createElement("style"),r=e.attributes||{};if(void 0===r.nonce){var n=s.nc;n&&(r.nonce=n)}if(Object.keys(r).forEach((function(e){t.setAttribute(e,r[e])})),"function"==typeof e.insert)e.insert(t);else{var a=i(e.insert||"head");if(!a)throw new Error("Couldn't find a style target. This probably means that the value for the 'insert' parameter is invalid.");a.appendChild(t)}return t}var l,h=(l=[],function(e,t){return l[e]=t,l.filter(Boolean).join("\n")});function u(e,t,s,r){var n=s?"":r.media?"@media ".concat(r.media," {").concat(r.css,"}"):r.css;if(e.styleSheet)e.styleSheet.cssText=h(t,n);else{var i=document.createTextNode(n),a=e.childNodes;a[t]&&e.removeChild(a[t]),a.length?e.insertBefore(i,a[t]):e.appendChild(i)}}function p(e,t,s){var r=s.css,n=s.media,i=s.sourceMap;if(n?e.setAttribute("media",n):e.removeAttribute("media"),i&&btoa&&(r+="\n/*# sourceMappingURL=data:application/json;base64,".concat(btoa(unescape(encodeURIComponent(JSON.stringify(i))))," */")),e.styleSheet)e.styleSheet.cssText=r;else{for(;e.firstChild;)e.removeChild(e.firstChild);e.appendChild(document.createTextNode(r))}}var m=null,_=0;function g(e,t){var s,r,n;if(t.singleton){var i=_++;s=m||(m=d(t)),r=u.bind(null,s,i,!1),n=u.bind(null,s,i,!0)}else s=d(t),r=p.bind(null,s,t),n=function(){!function(e){if(null===e.parentNode)return!1;e.parentNode.removeChild(e)}(s)};return r(e),function(t){if(t){if(t.css===e.css&&t.media===e.media&&t.sourceMap===e.sourceMap)return;r(e=t)}else n()}}e.exports=function(e,t){(t=t||{}).singleton||"boolean"==typeof t.singleton||(t.singleton=n());var s=c(e=e||[],t);return function(e){if(e=e||[],"[object Array]"===Object.prototype.toString.call(e)){for(var r=0;r<s.length;r++){var n=o(s[r]);a[n].references--}for(var i=c(e,t),d=0;d<s.length;d++){var l=o(s[d]);0===a[l].references&&(a[l].updater(),a.splice(l,1))}s=i}}}},function(e,t,s){(t=s(3)(!1)).push([e.i,".progress-bar{background-color:#fff;border:1px solid;border-radius:2px;margin:2px 0}.progress-bar .progress{background-color:firebrick;transition:300ms linear;height:8px;width:0%}.block{max-width:600px;color:white;background-color:#212121;font-size:1.1em;border-radius:2px;border:1px solid}html{background-image:linear-gradient(#bbdefb, #e1f5fe)}html .has-padding{padding:8px}html .has-padding-vertical{padding:8px 0}html .has-padding-horizontal{padding:0 8px}html .has-padding-small{padding:4px}html .has-padding-vertical-small{padding:4px 0}html .has-padding-horizontal-small{padding:0 4px}html .align-middle-center{margin:auto;width:50%}html .has-spacing>div{margin-bottom:4px}html .right{justify-self:end}html .left{justify-self:start}html .text-center{text-align:center}html .spinner{text-align:center}html .spinner i{max-width:200px}html .small-block{background-color:darkcyan;margin:0 2px;border:0.5px solid;border-radius:2px;padding:3px}html .cyan-block{max-width:600px;color:white;background-color:#212121;font-size:1.1em;border-radius:2px;border:1px solid;background-color:darkcyan;margin:4px 2px;padding:3px}html .golden-block{background-color:goldenrod;margin:4px 2px;border:0.5px solid;border-radius:2px;padding:3px}html #typer{text-align:center}html #typer #image-section{max-width:39em}html #typer #image-section img{width:100%}html #typer #summary-block{display:flex;max-width:600px;color:white;background-color:#212121;font-size:1.1em;border-radius:2px;border:1px solid}html #typer #bottom-section{text-align:center}html #typer #bottom-section #btn-reset{width:10em;font-size:1em;cursor:pointer;border-radius:2px;font-family:Times}html #typer #text-block{max-width:600px;color:white;background-color:#212121;font-size:1.1em;border-radius:2px;border:1px solid}html #typer #text-block #quote .success{color:#90ee90}html #typer #text-block #quote .failure{background-color:#f44336}html #typer #text-block #quote .underline{text-decoration:underline}html .typer-progress-indicator{height:9px;background-color:darkcyan;border:0.5px solid #fff;border-radius:2px}html .typer-progress-indicator .progress{transition:300ms linear;height:8px;display:inline-block;position:relative;left:0.5px;top:0.5px}html .typer-progress-indicator .success{background-color:#90ee90}html .typer-progress-indicator .failure{background-color:#f44336}html .toolbar{background-color:white;border-bottom:0.5px solid white;height:20px;opacity:0.75;padding:8px;margin:0}html footer{font-family:Arial, Helvetica, sans-serif;font-size:0.7em;position:absolute;bottom:8px;right:8px;text-align:right}@media (max-height: 400px){html footer{display:none}}html body{margin:0}html main{margin:8px}\n",""]),e.exports=t},function(e,t,s){"use strict";e.exports=function(e){var t=[];return t.toString=function(){return this.map((function(t){var s=function(e,t){var s=e[1]||"",r=e[3];if(!r)return s;if(t&&"function"==typeof btoa){var n=(a=r,o=btoa(unescape(encodeURIComponent(JSON.stringify(a)))),c="sourceMappingURL=data:application/json;charset=utf-8;base64,".concat(o),"/*# ".concat(c," */")),i=r.sources.map((function(e){return"/*# sourceURL=".concat(r.sourceRoot||"").concat(e," */")}));return[s].concat(i).concat([n]).join("\n")}var a,o,c;return[s].join("\n")}(t,e);return t[2]?"@media ".concat(t[2]," {").concat(s,"}"):s})).join("")},t.i=function(e,s,r){"string"==typeof e&&(e=[[null,e,""]]);var n={};if(r)for(var i=0;i<this.length;i++){var a=this[i][0];null!=a&&(n[a]=!0)}for(var o=0;o<e.length;o++){var c=[].concat(e[o]);r&&n[c[0]]||(s&&(c[2]?c[2]="".concat(s," and ").concat(c[2]):c[2]=s),t.push(c))}},t}},function(e,t,s){"use strict";s.r(t);class r{constructor(e="div"){this._self=document.createElement(e),this.setPadding(!1)}setId(e){this._self.id=e}setPadding(e){e?this.addClassName("has-padding"):this.removeClassName("has-padding")}setWidth(e){this._self.style.width=e}setHeight(e){this._self.style.height=e}addListener(e,t=(()=>{})){this._self.addEventListener(e,t)}addClassName(e){this._self.classList.add(e)}removeClassName(e){this._self.classList.remove(e)}focus(){this._self.setAttribute("tabindex",0),this._self.focus()}setVisible(e){e?this._self.removeAttribute("hidden"):this._self.setAttribute("hidden",!0)}setVisibleKeepSpace(e){this._self.style.visibility=e?"visible":"hidden"}}class n extends r{constructor(e="div"){super(e)}setSpacing(e){e?this.addClassName("has-spacing"):this.removeClassName("has-spacing")}setAlignment(e){switch(e){case"middle-center":this.addClassName("align-middle-center")}}add(){for(let e in arguments)this._self.appendChild(arguments[e]._self)}clear(){this._self.innerHTML=""}}class i extends n{constructor(){super("div")}}class a extends n{constructor(e=""){super("span"),this.text=e}set text(e){this._self.innerHTML=e}get text(){return this._text}setText(e){this.text=e}}class o extends i{constructor(e){super(),this.setId("text-block"),this.setPadding(!0),this._textSpans=[],this._text=e.text,this._charIndex=0,this._init()}_init(){this._populateContent(this._text),this._underlineCurrentChar(),this.focus()}_populateContent(e){let t=e.quote;this.add(new a("“"));let s=new a;s.setId("quote");for(let e in t){let r=new a(t[e]);r.setId(`char-${e}`),s.add(r),this._textSpans.push(r)}this.add(s),this.add(new a("” - "));let r=e.source;r&&r.length>0&&this.add(new a(r))}_underlineCurrentChar(){let e=this._textSpans[this._charIndex];e&&e.addClassName("underline")}_getCurrentCharSpan(){return this._textSpans[this._charIndex]}_colorCurrentChar(e){let t=this._getCurrentCharSpan();t.addClassName(e?"success":"failure"),t.removeClassName("underline")}addKeyPressListener(e=(()=>{})){this.addListener("keypress",e)}nextChar(e){this._colorCurrentChar(e),this._charIndex++,this._underlineCurrentChar()}isTextEndReached(){return this._charIndex>=this._text.quote.length}isWordEndReached(){return" "===this._text.quote[this._charIndex]||this.isTextEndReached()}getCurrentChar(){return this._text.quote[this._charIndex]}disable(){this._self.removeAttribute("tabindex")}}const c={en:{errors:"Errors",accuracy:"Accuracy",speed:"Speed",reset:"Reset"},fr:{errors:"Erreurs",accuracy:"Précision",speed:"Vitesse",reset:"Réinitialiser"}},d={en:["Short text.","Here is another text in english.","Hello, world!"],fr:["Un texte francais.","C'est un autre texte."]};class l{constructor(){this.languageCode="en";let e=new URLSearchParams(window.location.search).get("lang");e&&(this.languageCode=e)}static getInstance(){return this.i18n||(this.i18n=new l),this.i18n}translate(e){return c[this.languageCode][e]}setLanguageCode(e){this.languageCode=e}getLanguageCode(){return this.languageCode}generateText(){let e=Math.floor(Math.random()*d[this.languageCode].length);return d[this.languageCode][e]}}class h extends i{constructor(e){super(),this.setId("summary-block"),this.setPadding(!0),this._presenter=e,this._init()}_init(){let e=this._buildErrorBlock(),t=this._buildAccuracyBlock(),s=this._buildSpeedBlock();this.add(e),this.add(t),this.add(s)}_buildErrorBlock(){let e=new i;e.addClassName("small-block");let t=new a;return t.setId("errors_label"),t.setText(`${l.getInstance().translate("errors")} `),this._errorSpan=new a,this._errorSpan.setId("error-count"),this._errorSpan.setText(0),e.add(t),e.add(this._errorSpan),e}_buildAccuracyBlock(){let e=new i;e.setId("accuracy"),e.addClassName("small-block");let t=new a;t.setId("accuracy-label"),t.setText(`${l.getInstance().translate("accuracy")} `),this._accuracySpan=new a,this._accuracySpan.setId("accuracy-value"),this._accuracySpan.setText(100);let s=new a("%");return e.add(t),e.add(this._accuracySpan),e.add(s),e}_buildSpeedBlock(){let e=new i;e.setId("speed-block"),e.addClassName("small-block");let t=new a;t.setId("speed-label"),t.setText(`${l.getInstance().translate("speed")} `),this._speedSpan=new a,this._speedSpan.setId("speed"),this._speedSpan.setText(0);let s=new a(" CPM");return e.add(t),e.add(this._speedSpan),e.add(s),e}updateErrorSpan(e){this._errorSpan.setText(e)}updateAccuracySpan(e){this._accuracySpan.setText(e)}updateSpeedSpan(e){this._speedSpan.setText(e)}}class u{constructor(e,t,s){this._socket=e,this._typer=s,this._text=t,this._errorCount=0,this._charSuccessCount=0,this._charTypedCount=0,this._initTime=this._timeNow()}get text(){return this._text}_timeNow(){return Date.now()}_nextChar(e){this._charTypedCount++,this._typer.nextChar(e);let t={completePercent:Math.ceil(100*this._charTypedCount/this.text.quote.length),isSuccess:e};this._typer.broadcast(t)}_increaseErrorCount(){this._typer.updateErrorSpan(++this._errorCount)}charPressSuccess(){this._charSuccessCount++,this._nextChar(!0)}charPressFailure(){this._increaseErrorCount(),this._nextChar(!1)}updateSpeed(){let e=(this._timeNow()-this._initTime)/1e3,t=Math.ceil(60*this._charSuccessCount/e);this._typer.updateSpeedSpan(t)}updateAccuracyPercentage(){let e=Math.round(this._charSuccessCount/this._charTypedCount*100);this._typer.updateAccuracySpan(e)}}var p=s.p+"a069a29cfd9d21e11be1bd235e569c69.png";class m extends n{constructor(){super("button")}setText(e){this._self.innerHTML=e}}class _ extends r{constructor(){super("img")}setSrc(e){this._self.src=e}}class g extends i{constructor(e,t){super(),this.setId("typer"),this.setSpacing(!0),this.setAlignment("middle-center"),this._presenter=new u(e,t,this),this._socket=e,this._textBlock=new o(this._presenter),this._summary=new h(this._presenter),this._init()}_buildImageSection(){let e=new i;e.setId("image-section");let t=new _;return t.setId("image"),t.setSrc(p),e.add(t),e}_buildBottomSection(){let e=new i;return e.setId("bottom-section"),this._resetButton=new m,this._resetButton.setId("btn-reset"),this._resetButton.setVisibleKeepSpace(!1),this._resetButton.setText(`<i class="fa fa-refresh"></i> ${l.getInstance().translate("reset")}`),e.add(this._resetButton),e}_init(){let e=this._buildImageSection(),t=this._buildBottomSection();this.add(this._summary),this.add(e),this.add(this._textBlock),this.add(t),this.addListener("click",()=>{this._textBlock.focus()}),this._resetButton.addListener("click",()=>{location.reload()}),this._textBlock.addKeyPressListener(()=>{event.key===this._textBlock.getCurrentChar()?this._presenter.charPressSuccess():this._presenter.charPressFailure()})}nextChar(e){this._textBlock.nextChar(e),this._presenter.updateAccuracyPercentage(),this._textBlock.isWordEndReached()&&this._presenter.updateSpeed(),this._textBlock.isTextEndReached()&&(this._textBlock.disable(),this._resetButton.setVisibleKeepSpace(!0),this._resetButton.focus())}updateErrorSpan(e){this._summary.updateErrorSpan(e)}updateSpeedSpan(e){this._summary.updateSpeedSpan(e)}updateAccuracySpan(e){this._summary.updateAccuracySpan(e)}focus(){this._textBlock.focus()}broadcast(e){this._socket.emit("progress",e)}}class f extends r{constructor(){super("select"),this._options=[]}setName(e){this._self.name=e}onChange(e){this.addListener("change",e)}get options(){return this._options}addOption(e){this._options.push(e),this._self.appendChild(e)}}class x extends i{constructor(){super(),this.setId("#language-chooser select"),this._init()}_init(){this._form=document.createElement("form"),this._form.id="form-lang",this._form.innerHTML+='<i class="fa fa-language"></i> ',this._self.appendChild(this._form),this._select=this._buildSelect(),this._form.appendChild(this._select._self),this._updateComponent(),this._select.onChange(()=>{let e=event.target.selectedOptions[0].value;l.getInstance().setLanguageCode(e),console.log(this._select.options),this._form.submit()})}_buildSelect(){let e=new f;e.setName("lang");let t=new Option("En","en"),s=new Option("Fr","fr");return e.addOption(t),e.addOption(s),e}_updateComponent(){let e=l.getInstance().getLanguageCode();for(let t of this._select.options)t.value===e?t.setAttribute("selected",!0):t.removeAttribute("selected");document.querySelector("html").setAttribute("lang",e)}}class b{constructor(){this._baseUrl="http://localhost:5000",this._languageCode="en";let e=new URLSearchParams(window.location.search).get("lang");e&&(this._languageCode=e)}async exec(){const e=`${this._baseUrl}/text/random/${this._languageCode}`;let t=await fetch(e);if(t.ok){return await t.json()}throw`${t.status}: ${t.statusText}`}}class y extends i{constructor(){super(),this._completePercent=0,this._init()}_init(){this.addClassName("typer-progress-indicator")}_buildProgressPercent(e,t){let s=new i;return s.addClassName("progress"),s.addClassName(t?"success":"failure"),s.setWidth(`${e}%`),s._self.animate([{width:"0%"},{width:`${e}%`}],500),s}setValue(e,t){let s=e-this._completePercent;this._completePercent=e;const r=this._buildProgressPercent(s,t);this.add(r)}}class S extends i{constructor(e,t){super(),this._progressBarDict={},this._connectedSockets=t,this._socketId=e,this._init()}_init(){this.setSpacing(!0);for(let e in this._connectedSockets){let t=new i;t.setPadding(!0),t.addClassName("block"),t.add(new a(e===this._socketId?"Me":e));let s=new y;this._progressBarDict[e]=s,t.add(s),this.add(t)}}updateProgressFor(e,t,s){this._progressBarDict[e].setValue(t,s)}}class C{constructor(e){this._socket=e,this._progressBarDict={},this._init()}_init(){this._socket.on("connect",()=>{console.log("I'm connected:",this._socket.id)}),this._socket.on("message",e=>{this._connectedSocketsSection=new S(this._socket.id,e),this._connectedSocketsSection.setAlignment("middle-center");let t=document.querySelector("#connected-sockets");t.innerHTML="",t.appendChild(this._connectedSocketsSection._self)}),this._socket.on("progress",e=>{let t=e.socketId,s=e.progressValue.completePercent,r=e.progressValue.isSuccess;this._connectedSocketsSection.updateProgressFor(t,s,r)})}}class w extends n{constructor(){super("ul"),this.addClassName("toolbar")}addLeftElement(e){let t=new n("li");t.add(e),this.add(t)}}s(0);class k{constructor(e){this.service=new b,this._typer,this._socket=e,this._init()}_init(){this.service.exec().then(e=>{let t=this._buildToolBar();document.querySelector("header").appendChild(t._self),this._typer=new g(this._socket,e),document.querySelector("main").prepend(this._typer._self),this._typer.focus()}).catch(e=>{console.error(e)})}_buildToolBar(){let e=new w;return e.add(new x),e}_showContent(){this.spinner=document.querySelector("#spinner"),this.content=document.querySelector("#content"),this.spinner.setAttribute("hidden",!0),this.content.removeAttribute("hidden")}_populateFooter(){document.querySelector("footer").querySelector("span").innerHTML=(new Date).getFullYear()}}window.onload=()=>{const e=io("http://localhost:5000");new k(e),new C(e)}}]);